<!--Communication/SimpleCommunicationWindow.xaml-->
<!--简化的通讯管理窗口 - 实现用户要求的布局但使用简化的配置系统-->
<Window x:Class="VisionLite.Communication.SimpleCommunicationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:VisionLite.Communication"
        Title="通讯设置" Height="600" Width="900"
        WindowStartupLocation="CenterOwner" ShowInTaskbar="False"
        ResizeMode="CanResize" MinHeight="500" MinWidth="750">
    
    <!-- 窗口资源 -->
    <Window.Resources>
        <!-- 转换器 -->
        <local:ConnectionTypeToDisplayConverter x:Key="ConnectionTypeToDisplayConverter"/>
        
        <!-- DataGrid样式 -->
        <Style TargetType="DataGrid">
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="LightGray"/>
            <Setter Property="RowBackground" Value="White"/>
            <Setter Property="AlternatingRowBackground" Value="#F8F8F8"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="CanUserReorderColumns" Value="False"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
        </Style>

        <!-- 按钮样式 -->
        <Style x:Key="ToolButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="70"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Margin" Value="5,2"/>
        </Style>

        <!-- 状态指示器样式 -->
        <Style x:Key="StatusIndicatorStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="Margin" Value="5,0"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <!-- 左侧连接列表区域 -->
            <ColumnDefinition Width="350" MinWidth="250"/>
            <!-- 右侧参数和日志区域 -->
            <ColumnDefinition Width="*" MinWidth="350"/>
        </Grid.ColumnDefinitions>

        <!-- 分隔线 -->
        <GridSplitter Grid.Column="0" HorizontalAlignment="Right" Width="3" 
                      Background="LightGray" ResizeBehavior="PreviousAndNext"/>

        <!-- 左侧：连接列表 -->
        <Grid Grid.Column="0" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>   <!-- 标题和工具栏 -->
                <RowDefinition Height="*"/>      <!-- 连接列表 -->
            </Grid.RowDefinitions>

            <!-- 连接列表标题和操作按钮 -->
            <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,10">
                <TextBlock Text="通讯连接" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
                
                <!-- 操作按钮栏 -->
                <StackPanel Orientation="Horizontal">
                    <Button x:Name="AddButton" Content="添加" 
                            Style="{StaticResource ToolButtonStyle}"
                            Click="AddButton_Click"/>
                    <Button x:Name="EditButton" Content="编辑" 
                            Style="{StaticResource ToolButtonStyle}"
                            Click="EditButton_Click" 
                            IsEnabled="False"/>
                    <Button x:Name="DeleteButton" Content="删除" 
                            Style="{StaticResource ToolButtonStyle}"
                            Click="DeleteButton_Click" 
                            IsEnabled="False"/>
                    <Button x:Name="CopyButton" Content="复制" 
                            Style="{StaticResource ToolButtonStyle}"
                            Click="CopyButton_Click" 
                            IsEnabled="False"/>
                </StackPanel>
            </StackPanel>

            <!-- 连接列表 -->
            <DataGrid Grid.Row="1" x:Name="ConnectionDataGrid"
                      SelectionChanged="ConnectionDataGrid_SelectionChanged">
                <DataGrid.Columns>
                    <!-- 状态指示器 -->
                    <DataGridTemplateColumn Header="" Width="30">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Ellipse Style="{StaticResource StatusIndicatorStyle}"
                                         Fill="{Binding StatusBrush}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- 连接名称 -->
                    <DataGridTextColumn Header="连接名称" Binding="{Binding Name}" Width="*"/>
                    
                    <!-- 协议类型 -->
                    <DataGridTextColumn Header="类型" 
                                        Binding="{Binding Type, Converter={StaticResource ConnectionTypeToDisplayConverter}}" 
                                        Width="80"/>
                    
                    <!-- 连接描述 -->
                    <DataGridTextColumn Header="地址" Binding="{Binding Description}" Width="100"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!-- 右侧：参数配置和通讯日志 -->
        <Grid Grid.Column="1" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>   <!-- 连接参数区域 -->
                <RowDefinition Height="Auto"/>   <!-- 连接控制区域 -->
                <RowDefinition Height="*"/>      <!-- 通讯日志区域 -->
            </Grid.RowDefinitions>

            <!-- 连接参数显示区域 -->
            <GroupBox Grid.Row="0" Header="连接参数" Margin="0,0,0,10" 
                      MinHeight="120" MaxHeight="200">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="ParameterDisplayPanel" Margin="10">
                        <TextBlock Text="请选择一个连接查看参数信息" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="Gray" FontStyle="Italic" Margin="20"
                                   x:Name="EmptyParameterHint"/>
                    </StackPanel>
                </ScrollViewer>
            </GroupBox>

            <!-- 连接控制区域 -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" 
                        HorizontalAlignment="Left" Margin="0,0,0,10">
                
                <!-- 连接/断开按钮 -->
                <Button x:Name="ConnectButton" Content="连接" Width="80" Height="32" 
                        Margin="0,0,10,0" Click="ConnectButton_Click" 
                        IsEnabled="False"/>
                
                <!-- 连接状态显示 -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="状态：" VerticalAlignment="Center"/>
                    <Ellipse x:Name="ConnectionStatusIndicator" 
                             Width="16" Height="16" Fill="Gray" Margin="5,0"/>
                    <TextBlock x:Name="ConnectionStatusText" Text="未连接" 
                               VerticalAlignment="Center" Margin="5,0"/>
                </StackPanel>
            </StackPanel>

            <!-- 通讯日志和发送区域 -->
            <GroupBox Grid.Row="2" Header="通讯日志" Padding="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>      <!-- 日志显示区域 -->
                        <RowDefinition Height="Auto"/>    <!-- 发送控制区域 -->
                    </Grid.RowDefinitions>

                    <!-- 日志显示 -->
                    <TextBox Grid.Row="0" x:Name="LogTextBox" 
                             IsReadOnly="True" VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto" 
                             FontFamily="Consolas" FontSize="12"
                             Background="Black" Foreground="Lime"
                             Margin="0,0,0,5"/>

                    <!-- 发送控制区域 -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- 发送消息输入框 -->
                        <TextBox Grid.Column="0" x:Name="SendTextBox" 
                                 Height="26" VerticalContentAlignment="Center"
                                 KeyDown="SendTextBox_KeyDown"/>

                        <!-- 发送按钮 -->
                        <Button Grid.Column="1" x:Name="SendButton" Content="发送" 
                                Width="60" Height="26" Margin="5,0" 
                                Click="SendButton_Click" IsEnabled="False"/>

                        <!-- 清空日志按钮 -->
                        <Button Grid.Column="2" x:Name="ClearLogButton" Content="清空" 
                                Width="60" Height="26" 
                                Click="ClearLogButton_Click"/>
                    </Grid>
                </Grid>
            </GroupBox>
        </Grid>
    </Grid>
</Window>