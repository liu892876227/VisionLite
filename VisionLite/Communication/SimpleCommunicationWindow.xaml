<!--Communication/SimpleCommunicationWindow.xaml-->
<!--简化的通讯管理窗口 - 实现用户要求的布局但使用简化的配置系统-->
<Window x:Class="VisionLite.Communication.SimpleCommunicationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:VisionLite.Communication"
        Title="通讯设置" Height="600" Width="900"
        WindowStartupLocation="CenterOwner" ShowInTaskbar="False"
        ResizeMode="CanResize" MinHeight="500" MinWidth="750">
    
    <!-- 窗口资源 -->
    <Window.Resources>
        <!-- 转换器 -->
        <local:ConnectionTypeToDisplayConverter x:Key="ConnectionTypeToDisplayConverter"/>
        
        <!-- DataGrid样式 -->
        <Style TargetType="DataGrid">
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="LightGray"/>
            <Setter Property="RowBackground" Value="White"/>
            <Setter Property="AlternatingRowBackground" Value="#F8F8F8"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="CanUserReorderColumns" Value="False"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
        </Style>

        <!-- 按钮样式 -->
        <Style x:Key="ToolButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="70"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Margin" Value="5,2"/>
        </Style>

        <!-- 状态指示器样式 -->
        <Style x:Key="StatusIndicatorStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="Margin" Value="5,0"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <!-- 左侧连接列表区域 -->
            <ColumnDefinition Width="350" MinWidth="250"/>
            <!-- 分隔线区域 -->
            <ColumnDefinition Width="5"/>
            <!-- 右侧参数和日志区域 -->
            <ColumnDefinition Width="*" MinWidth="350"/>
        </Grid.ColumnDefinitions>

        <!-- 分隔线 -->
        <GridSplitter Grid.Column="1" 
                      Background="LightGray" ResizeBehavior="PreviousAndNext"
                      ShowsPreview="False" VerticalAlignment="Stretch"
                      HorizontalAlignment="Stretch"
                      Cursor="SizeWE"/>

        <!-- 左侧：连接列表 -->
        <Grid Grid.Column="0" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>   <!-- 标题和工具栏 -->
                <RowDefinition Height="*"/>      <!-- 连接列表 -->
            </Grid.RowDefinitions>

            <!-- 连接列表标题和操作按钮 -->
            <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,10">
                <TextBlock Text="通讯连接" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
                
                <!-- 操作按钮栏 -->
                <StackPanel Orientation="Horizontal">
                    <Button x:Name="AddButton" Content="添加" 
                            Style="{StaticResource ToolButtonStyle}"
                            Click="AddButton_Click"/>
                    <Button x:Name="EditButton" Content="编辑" 
                            Style="{StaticResource ToolButtonStyle}"
                            Click="EditButton_Click" 
                            IsEnabled="False"/>
                    <Button x:Name="DeleteButton" Content="删除" 
                            Style="{StaticResource ToolButtonStyle}"
                            Click="DeleteButton_Click" 
                            IsEnabled="False"/>
                    <Button x:Name="CopyButton" Content="复制" 
                            Style="{StaticResource ToolButtonStyle}"
                            Click="CopyButton_Click" 
                            IsEnabled="False"/>
                </StackPanel>
            </StackPanel>

            <!-- 连接列表 -->
            <DataGrid Grid.Row="1" x:Name="ConnectionDataGrid"
                      SelectionChanged="ConnectionDataGrid_SelectionChanged">
                <DataGrid.Columns>
                    <!-- 状态指示器 -->
                    <DataGridTemplateColumn Header="" Width="30">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Ellipse Style="{StaticResource StatusIndicatorStyle}"
                                         Fill="{Binding StatusBrush}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- 连接名称 -->
                    <DataGridTextColumn Header="连接名称" Binding="{Binding Name}" Width="*"/>
                    
                    <!-- 协议类型 -->
                    <DataGridTextColumn Header="类型" 
                                        Binding="{Binding Type, Converter={StaticResource ConnectionTypeToDisplayConverter}}" 
                                        Width="80"/>
                    
                    <!-- 连接描述 -->
                    <DataGridTextColumn Header="地址" Binding="{Binding Description}" Width="100"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!-- 右侧：参数配置和通讯日志 -->
        <Grid Grid.Column="2" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>   <!-- 连接参数区域 -->
                <RowDefinition Height="Auto"/>   <!-- 连接控制区域 -->
                <RowDefinition Height="Auto"/>   <!-- ModbusTCP专用操作面板区域 -->
                <RowDefinition Height="Auto"/>   <!-- ADS专用操作面板区域 -->
                <RowDefinition Height="Auto"/>   <!-- 串口专用操作面板区域 -->
                <RowDefinition Height="Auto"/>   <!-- S7 PLC专用操作面板区域 -->
                <RowDefinition Height="*"/>      <!-- 通讯日志区域 -->
            </Grid.RowDefinitions>

            <!-- 连接参数显示区域 -->
            <GroupBox Grid.Row="0" Header="连接参数" Margin="0,0,0,10" 
                      MinHeight="120" MaxHeight="200">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="ParameterDisplayPanel" Margin="10">
                        <TextBlock Text="请选择一个连接查看参数信息" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="Gray" FontStyle="Italic" Margin="20"
                                   x:Name="EmptyParameterHint"/>
                    </StackPanel>
                </ScrollViewer>
            </GroupBox>

            <!-- 连接控制区域 -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" 
                        HorizontalAlignment="Left" Margin="0,0,0,10">
                
                <!-- 连接/断开按钮 -->
                <Button x:Name="ConnectButton" Content="连接" Width="80" Height="32" 
                        Margin="0,0,10,0" Click="ConnectButton_Click" 
                        IsEnabled="False"/>
                
                <!-- 连接状态显示 -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="状态：" VerticalAlignment="Center"/>
                    <Ellipse x:Name="ConnectionStatusIndicator" 
                             Width="16" Height="16" Fill="Gray" Margin="5,0"/>
                    <TextBlock x:Name="ConnectionStatusText" Text="未连接" 
                               VerticalAlignment="Center" Margin="5,0"/>
                </StackPanel>
            </StackPanel>

            <!-- ModbusTCP专用操作面板 -->
            <GroupBox x:Name="ModbusTcpOperationPanel" Grid.Row="2" Header="ModbusTCP 操作面板" 
                      Padding="10" Margin="0,0,0,10" Visibility="Collapsed">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>   <!-- 操作设置区域 -->
                        <RowDefinition Height="Auto"/>   <!-- 地址设置区域 -->
                        <RowDefinition Height="Auto"/>   <!-- 执行控制区域 -->
                        <RowDefinition Height="Auto"/>   <!-- 实时状态区域 -->
                    </Grid.RowDefinitions>

                    <!-- 操作设置区域 -->
                    <GroupBox Grid.Row="0" Header="操作设置" Margin="0,0,0,8" Padding="8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <Label Grid.Column="0" Content="操作类型:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="OperationTypeComboBox" Grid.Column="1" Height="25" Margin="0,0,10,0"
                                      SelectionChanged="OperationTypeComboBox_SelectionChanged">
                                <ComboBoxItem Content="读取" Tag="READ"/>
                                <ComboBoxItem Content="写入" Tag="WRITE"/>
                            </ComboBox>
                            
                            <Label Grid.Column="2" Content="数据类型:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="DataTypeComboBox" Grid.Column="3" Height="25"
                                      SelectionChanged="DataTypeComboBox_SelectionChanged">
                                <ComboBoxItem Content="线圈" Tag="COIL"/>
                                <ComboBoxItem Content="保持寄存器" Tag="HOLDING"/>
                                <ComboBoxItem Content="输入寄存器" Tag="INPUT"/>
                                <ComboBoxItem Content="离散输入" Tag="DISCRETE"/>
                                <ComboBoxItem Content="浮点数(32位)" Tag="FLOAT"/>
                            </ComboBox>
                        </Grid>
                    </GroupBox>

                    <!-- 地址设置区域 -->
                    <GroupBox Grid.Row="1" Header="地址设置" Margin="0,0,0,8" Padding="8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <Label Grid.Column="0" Content="起始地址:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBox x:Name="StartAddressTextBox" Grid.Column="1" Height="25" Margin="0,0,10,0" 
                                     Text="0" VerticalContentAlignment="Center"/>
                            
                            <Label Grid.Column="2" Content="数量/数值:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBox x:Name="QuantityValueTextBox" Grid.Column="3" Height="25" Margin="0,0,10,0" 
                                     Text="1" VerticalContentAlignment="Center"/>
                            
                            <Label Grid.Column="4" Content="显示格式:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="DisplayFormatComboBox" Grid.Column="5" Height="25">
                                <ComboBoxItem Content="十进制" Tag="DEC" IsSelected="True"/>
                                <ComboBoxItem Content="十六进制" Tag="HEX"/>
                                <ComboBoxItem Content="二进制" Tag="BIN"/>
                            </ComboBox>
                        </Grid>
                    </GroupBox>

                    <!-- 执行控制区域 -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,8">
                        <Button x:Name="ExecuteOperationButton" Content="执行操作" Width="80" Height="28" 
                                Margin="0,0,8,0" Click="ExecuteOperationButton_Click"/>
                    </StackPanel>


                    <!-- 实时状态区域 -->
                    <GroupBox Grid.Row="3" Header="实时状态" Padding="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="最后操作:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="LastOperationText" Text="无" FontWeight="Bold" Margin="0,0,16,0"/>
                                <TextBlock Text="时间:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="LastOperationTime" Text="--:--:--"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="操作结果:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="OperationResult" Text="待执行" FontWeight="Bold" Margin="0,0,16,0"/>
                                <TextBlock Text="用时:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="OperationDuration" Text="0ms"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Orientation="Horizontal">
                                <TextBlock Text="返回数据:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="ReturnedData" Text="无" FontFamily="Consolas" 
                                          TextWrapping="Wrap" MaxWidth="400"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>
                </Grid>
            </GroupBox>

            <!-- ADS专用操作面板 -->
            <GroupBox x:Name="AdsOperationPanel" Grid.Row="3" Header="倍福ADS操作面板" 
                      Padding="10" Margin="0,0,0,10" Visibility="Collapsed">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>   <!-- 变量操作区域 -->
                        <RowDefinition Height="Auto"/>   <!-- 操作控制区域 -->
                        <RowDefinition Height="Auto"/>   <!-- 实时状态区域 -->
                    </Grid.RowDefinitions>

                    <!-- 变量操作区域 -->
                    <GroupBox Grid.Row="0" Header="变量读写操作" Margin="0,0,0,8" Padding="8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Label Grid.Column="0" Grid.Row="0" Content="操作类型:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="AdsOperationTypeComboBox" Grid.Column="1" Grid.Row="0" Height="25" Margin="0,0,10,0">
                                <ComboBoxItem Content="读取变量" Tag="READ"/>
                                <ComboBoxItem Content="写入变量" Tag="write"/>
                            </ComboBox>
                            
                            <Label Grid.Column="2" Grid.Row="0" Content="数据类型:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="AdsDataTypeComboBox" Grid.Column="3" Grid.Row="0" Height="25">
                                <ComboBoxItem Content="布尔型(BOOL)" Tag="BOOL"/>
                                <ComboBoxItem Content="字节型(BYTE)" Tag="BYTE"/>
                                <ComboBoxItem Content="整数型(INT)" Tag="INT"/>
                                <ComboBoxItem Content="双整数(DINT)" Tag="DINT"/>
                                <ComboBoxItem Content="实数型(REAL)" Tag="REAL"/>
                                <ComboBoxItem Content="长实数(LREAL)" Tag="LREAL"/>
                                <ComboBoxItem Content="字符串(STRING)" Tag="STRING"/>
                            </ComboBox>
                            
                            <Label Grid.Column="0" Grid.Row="1" Content="变量名:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBox x:Name="AdsVariableNameTextBox" Grid.Column="1" Grid.Row="1" Height="25" Margin="0,5,10,5" 
                                     VerticalContentAlignment="Center" 
                                     Text="MAIN.bTest" 
                                     ToolTip="PLC变量名，如：MAIN.bEnable, GVL.nSpeed"/>
                            
                            <Label Grid.Column="2" Grid.Row="1" Content="写入值:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBox x:Name="AdsValueTextBox" Grid.Column="3" Grid.Row="1" Height="25" Margin="0,5,0,5" 
                                     VerticalContentAlignment="Center"
                                     Text="true"
                                     ToolTip="要写入的值，格式根据数据类型而定"/>
                        </Grid>
                    </GroupBox>

                    <!-- 操作控制区域 -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,8">
                        <Button x:Name="ExecuteAdsOperationButton" Content="执行操作" Width="80" Height="28" 
                                Margin="0,0,8,0" Click="ExecuteAdsOperationButton_Click"/>
                        <Button x:Name="AdsConnectionTestButton" Content="连接测试" Width="80" Height="28" 
                                Margin="0,0,8,0" Click="AdsConnectionTestButton_Click"/>
                    </StackPanel>

                    <!-- 实时状态区域 -->
                    <GroupBox Grid.Row="2" Header="操作状态" Padding="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="最后操作:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="AdsLastOperationText" Text="无" FontWeight="Bold" Margin="0,0,16,0"/>
                                <TextBlock Text="时间:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="AdsLastOperationTime" Text="--:--:--"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="操作结果:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="AdsOperationResult" Text="待执行" FontWeight="Bold" Margin="0,0,16,0"/>
                                <TextBlock Text="用时:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="AdsOperationDuration" Text="0ms"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Orientation="Horizontal">
                                <TextBlock Text="返回数据:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="AdsReturnedData" Text="无" FontFamily="Consolas" 
                                          TextWrapping="Wrap" MaxWidth="400"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>
                </Grid>
            </GroupBox>

            <!-- 串口专用操作面板 -->
            <GroupBox x:Name="SerialOperationPanel" Grid.Row="4" Header="串口通讯测试" 
                      Padding="10" Margin="0,0,0,10" Visibility="Collapsed">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>   <!-- 发送区域 -->
                        <RowDefinition Height="Auto"/>   <!-- 快捷操作区域 -->
                        <RowDefinition Height="Auto"/>   <!-- 接收显示设置区域 -->
                    </Grid.RowDefinitions>

                    <!-- 发送区域 -->
                    <GroupBox Grid.Row="0" Header="数据发送" Margin="0,0,0,8" Padding="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- 发送数据输入 -->
                            <TextBox x:Name="SerialSendTextBox" Grid.Row="0" 
                                     Height="60" Margin="0,0,0,8"
                                     AcceptsReturn="True" TextWrapping="Wrap"
                                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                                     FontFamily="Consolas" FontSize="12"
                                     VerticalContentAlignment="Top"
                                     TextChanged="SerialSendTextBox_TextChanged"/>
                            
                            <!-- 发送控制 -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <Button Grid.Column="0" x:Name="SerialSendButton" Content="发送" 
                                        Width="60" Height="26" Margin="0,0,8,0"
                                        Click="SerialSendButton_Click"/>
                                        
                                <Button Grid.Column="1" x:Name="SerialClearButton" Content="清空" 
                                        Width="60" Height="26" Margin="0,0,8,0"
                                        Click="SerialClearButton_Click"/>
                                
                                <Label Grid.Column="2" Content="格式:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <ComboBox Grid.Column="3" x:Name="SerialDataFormatComboBox" 
                                          Width="100" Height="26"
                                          SelectionChanged="SerialDataFormatComboBox_SelectionChanged">
                                    <ComboBoxItem Content="文本格式" Tag="Text" IsSelected="True"/>
                                    <ComboBoxItem Content="十六进制" Tag="Hex"/>
                                    <ComboBoxItem Content="二进制" Tag="Binary"/>
                                </ComboBox>
                                
                                <!-- 空白占位列 -->
                                <Grid Grid.Column="4"/>
                                
                                <CheckBox Grid.Column="5" x:Name="SerialAutoSendCheckBox" 
                                          Content="自动换行" Margin="8,0,0,0"
                                          VerticalAlignment="Center"/>
                            </Grid>
                        </Grid>
                    </GroupBox>

                    <!-- 接收显示设置 -->
                    <GroupBox Grid.Row="1" Header="接收设置" Padding="8">
                        <StackPanel Orientation="Horizontal">
                            <CheckBox x:Name="SerialShowTimestampCheckBox" Content="显示时间戳" 
                                      Margin="0,0,16,0" VerticalAlignment="Center" IsChecked="True"/>
                            <CheckBox x:Name="SerialShowHexCheckBox" Content="显示十六进制" 
                                      Margin="0,0,16,0" VerticalAlignment="Center"/>
                            <CheckBox x:Name="SerialAutoScrollCheckBox" Content="自动滚动" 
                                      Margin="0,0,16,0" VerticalAlignment="Center" IsChecked="True"/>
                            <Label Content="显示格式:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="SerialReceiveFormatComboBox" Width="100" Height="24">
                                <ComboBoxItem Content="原始数据" Tag="Raw" IsSelected="True"/>
                                <ComboBoxItem Content="十六进制" Tag="Hex"/>
                                <ComboBoxItem Content="ASCII显示" Tag="ASCII"/>
                            </ComboBox>
                        </StackPanel>
                    </GroupBox>
                </Grid>
            </GroupBox>

            <!-- S7 PLC专用操作面板 -->
            <GroupBox x:Name="S7OperationPanel" Grid.Row="5" Header="西门子S7 PLC操作面板" 
                      Padding="10" Margin="0,0,0,10" Visibility="Collapsed">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>   <!-- 变量操作区域 -->
                        <RowDefinition Height="Auto"/>   <!-- 操作控制区域 -->
                        <RowDefinition Height="Auto"/>   <!-- 实时状态区域 -->
                    </Grid.RowDefinitions>

                    <!-- 变量操作区域 -->
                    <GroupBox Grid.Row="0" Header="变量读写操作" Margin="0,0,0,8" Padding="8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Label Grid.Column="0" Grid.Row="0" Content="操作类型:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="S7OperationTypeComboBox" Grid.Column="1" Grid.Row="0" Height="25" Margin="0,0,10,0">
                                <ComboBoxItem Content="读取变量" Tag="read"/>
                                <ComboBoxItem Content="写入变量" Tag="write"/>
                            </ComboBox>
                            
                            <Label Grid.Column="2" Grid.Row="0" Content="数据类型:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="S7DataTypeComboBox" Grid.Column="3" Grid.Row="0" Height="25">
                                <ComboBoxItem Content="布尔型(BOOL)" Tag="BOOL"/>
                                <ComboBoxItem Content="字节型(BYTE)" Tag="BYTE"/>
                                <ComboBoxItem Content="字型(WORD)" Tag="WORD"/>
                                <ComboBoxItem Content="双字型(DWORD)" Tag="DWORD"/>
                                <ComboBoxItem Content="整数型(INT)" Tag="INT"/>
                                <ComboBoxItem Content="双整数(DINT)" Tag="DINT"/>
                                <ComboBoxItem Content="实数型(REAL)" Tag="REAL"/>
                                <ComboBoxItem Content="长实数(LREAL)" Tag="LREAL"/>
                                <ComboBoxItem Content="字符串(STRING)" Tag="STRING"/>
                            </ComboBox>
                            
                            <Label Grid.Column="0" Grid.Row="1" Content="变量地址:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBox x:Name="S7AddressTextBox" Grid.Column="1" Grid.Row="1" Height="25" Margin="0,5,10,5" 
                                     VerticalContentAlignment="Center" 
                                     Text="DB1.DBX0.0" 
                                     ToolTip="S7地址格式，如：DB1.DBX0.0, DB1.DBW2, M0.0, I0.0, Q0.0"/>
                            
                            <Label Grid.Column="2" Grid.Row="1" Content="写入值:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBox x:Name="S7ValueTextBox" Grid.Column="3" Grid.Row="1" Height="25" Margin="0,5,0,5" 
                                     VerticalContentAlignment="Center"
                                     Text="true"
                                     ToolTip="要写入的值，格式根据数据类型而定"/>
                        </Grid>
                    </GroupBox>

                    <!-- 操作控制区域 -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,8">
                        <Button x:Name="ExecuteS7OperationButton" Content="执行操作" Width="80" Height="28" 
                                Margin="0,0,8,0" Click="ExecuteS7OperationButton_Click"/>
                        <Button x:Name="S7ConnectionTestButton" Content="连接测试" Width="80" Height="28" 
                                Margin="0,0,8,0" Click="S7ConnectionTestButton_Click"/>
                    </StackPanel>

                    <!-- 实时状态区域 -->
                    <GroupBox Grid.Row="2" Header="操作状态" Padding="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="最后操作:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="S7LastOperationText" Text="无" FontWeight="Bold" Margin="0,0,16,0"/>
                                <TextBlock Text="时间:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="S7LastOperationTime" Text="--:--:--"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="操作结果:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="S7OperationResult" Text="待执行" FontWeight="Bold" Margin="0,0,16,0"/>
                                <TextBlock Text="用时:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="S7OperationDuration" Text="0ms"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Orientation="Horizontal">
                                <TextBlock Text="返回数据:" Margin="0,0,8,0"/>
                                <TextBlock x:Name="S7ReturnedData" Text="无" FontFamily="Consolas" 
                                          TextWrapping="Wrap" MaxWidth="400"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>
                </Grid>
            </GroupBox>

            <!-- 通讯日志和发送区域 -->
            <GroupBox Grid.Row="6" Header="通讯日志" Padding="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>      <!-- 日志显示区域 -->
                        <RowDefinition Height="Auto"/>    <!-- 发送控制区域 -->
                    </Grid.RowDefinitions>

                    <!-- 日志显示 -->
                    <TextBox Grid.Row="0" x:Name="LogTextBox" 
                             IsReadOnly="True" VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto" 
                             FontFamily="Consolas" FontSize="12"
                             Background="Black" Foreground="Lime"
                             Margin="0,0,0,5"/>

                    <!-- 发送控制区域 -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- 发送消息输入框 -->
                        <TextBox Grid.Column="0" x:Name="SendTextBox" 
                                 Height="26" VerticalContentAlignment="Center"
                                 KeyDown="SendTextBox_KeyDown"/>

                        <!-- 发送按钮 -->
                        <Button Grid.Column="1" x:Name="SendButton" Content="发送" 
                                Width="60" Height="26" Margin="5,0" 
                                Click="SendButton_Click" IsEnabled="False"/>

                        <!-- 清空日志按钮 -->
                        <Button Grid.Column="2" x:Name="ClearLogButton" Content="清空" 
                                Width="60" Height="26" 
                                Click="ClearLogButton_Click"/>
                    </Grid>
                </Grid>
            </GroupBox>
        </Grid>
    </Grid>
</Window>