<!--Communication/NewCommunicationWindow.xaml-->
<!--新版通讯管理窗口 - 按照用户需求重新设计的界面布局-->
<Window x:Class="VisionLite.Communication.NewCommunicationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:VisionLite.Communication"
        Title="通讯管理" Height="700" Width="1000"
        WindowStartupLocation="CenterOwner" ShowInTaskbar="False"
        MinHeight="600" MinWidth="800">
    
    <Window.Resources>
        <!-- 状态到颜色的转换器 -->
        <local:StatusToColorConverter x:Key="StatusToColorConverter"/>
        
        <!-- 数据网格样式 -->
        <Style x:Key="ConnectionDataGridStyle" TargetType="DataGrid">
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="AlternatingRowBackground" Value="#F5F5F5"/>
        </Style>
        
        <!-- 按钮样式 -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="80"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Margin" Value="5,2"/>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350"/>        <!-- 左侧连接列表区域 -->
            <ColumnDefinition Width="5"/>          <!-- 分割线 -->
            <ColumnDefinition Width="*"/>          <!-- 右侧详细信息区域 -->
        </Grid.ColumnDefinitions>

        <!-- 左侧：通讯连接列表和管理按钮 -->
        <DockPanel Grid.Column="0">
            <!-- 标题 -->
            <TextBlock DockPanel.Dock="Top" Text="通讯连接列表" FontWeight="Bold" 
                       Margin="5,0,0,10" FontSize="14"/>
            
            <!-- 底部按钮区域 -->
            <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" 
                        HorizontalAlignment="Center" Margin="5,10,5,0">
                <Button x:Name="AddConnectionButton" Content="添加" 
                        Style="{StaticResource ActionButtonStyle}"
                        Click="AddConnection_Click" 
                        ToolTip="添加新的通讯连接"/>
                <Button x:Name="EditConnectionButton" Content="编辑" 
                        Style="{StaticResource ActionButtonStyle}"
                        Click="EditConnection_Click" 
                        IsEnabled="False"
                        ToolTip="编辑选中的通讯连接"/>
                <Button x:Name="DeleteConnectionButton" Content="删除" 
                        Style="{StaticResource ActionButtonStyle}"
                        Click="DeleteConnection_Click" 
                        IsEnabled="False"
                        ToolTip="删除选中的通讯连接"/>
                <Button x:Name="CopyConnectionButton" Content="复制" 
                        Style="{StaticResource ActionButtonStyle}"
                        Click="CopyConnection_Click" 
                        IsEnabled="False"
                        ToolTip="复制选中的通讯连接"/>
            </StackPanel>
            
            <!-- 连接列表 -->
            <DataGrid x:Name="ConnectionDataGrid" 
                      Style="{StaticResource ConnectionDataGridStyle}"
                      SelectionChanged="ConnectionDataGrid_SelectionChanged"
                      Margin="5">
                <DataGrid.Columns>
                    <!-- 连接名称列 -->
                    <DataGridTextColumn Header="连接名称" Binding="{Binding Name}" Width="120"/>
                    
                    <!-- 协议类型列 -->
                    <DataGridTextColumn Header="协议类型" Binding="{Binding ProtocolDisplayName}" Width="100"/>
                    
                    <!-- 连接状态列 -->
                    <DataGridTemplateColumn Header="状态" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Ellipse Width="10" Height="10" 
                                         Fill="{Binding Status, Converter={StaticResource StatusToColorConverter}}"
                                         ToolTip="{Binding Status}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </DockPanel>

        <!-- 分割线 -->
        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" 
                      VerticalAlignment="Stretch" Background="LightGray"/>

        <!-- 右侧：详细配置和日志区域 -->
        <Grid Grid.Column="2" Margin="10,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>      <!-- 通讯参数配置区 -->
                <RowDefinition Height="Auto"/>      <!-- 连接控制区 -->
                <RowDefinition Height="*"/>         <!-- 通讯日志区 -->
            </Grid.RowDefinitions>

            <!-- 通讯参数配置区域 -->
            <GroupBox Grid.Row="0" Header="通讯参数" x:Name="ParameterGroupBox" 
                      IsEnabled="False" MaxHeight="250">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="DynamicParameterPanel" Margin="5">
                        <TextBlock Text="请选择连接以查看参数配置" 
                                   HorizontalAlignment="Center" 
                                   VerticalAlignment="Center"
                                   Foreground="Gray" FontStyle="Italic"
                                   x:Name="EmptyParameterHint"/>
                    </StackPanel>
                </ScrollViewer>
            </GroupBox>

            <!-- 连接控制区域 -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" 
                        Margin="0,10,0,10" HorizontalAlignment="Left">
                <!-- 连接/断开按钮 -->
                <Button x:Name="ConnectionToggleButton" Content="连接" 
                        Width="100" Height="30" 
                        Click="ConnectionToggle_Click"
                        IsEnabled="False"
                        ToolTip="连接或断开选中的通讯"/>
                
                <!-- 连接状态显示 -->
                <TextBlock x:Name="ConnectionStatusText" Text="未选择连接" 
                           VerticalAlignment="Center" Margin="15,0,0,0"
                           FontWeight="Bold"/>
                
                <!-- 服务器专用信息（如果是服务器类型才显示） -->
                <StackPanel x:Name="ServerInfoPanel" Orientation="Horizontal" 
                            Visibility="Collapsed" Margin="20,0,0,0">
                    <TextBlock Text="客户端:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock x:Name="ClientCountText" Text="0" 
                               VerticalAlignment="Center" FontWeight="Bold"/>
                    <Button x:Name="ManageClientsButton" Content="管理客户端" 
                            Width="80" Height="25" Margin="10,0,0,0"
                            Click="ManageClients_Click"/>
                </StackPanel>
            </StackPanel>

            <!-- 通讯日志和发送区域 -->
            <GroupBox Grid.Row="2" Header="通讯日志" Margin="0,0,0,0">
                <DockPanel>
                    <!-- 底部发送区域 -->
                    <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" 
                                Margin="5" Height="30">
                        <TextBox x:Name="SendMessageTextBox" Width="300" 
                                 ToolTip="输入要发送的消息"/>
                        <Button x:Name="SendButton" Content="发送" 
                                Width="60" Margin="5,0" 
                                Click="SendMessage_Click"
                                ToolTip="发送消息"/>
                        <Button x:Name="ClearLogButton" Content="清空" 
                                Width="60" 
                                Click="ClearLog_Click"
                                ToolTip="清空日志"/>
                    </StackPanel>
                    
                    <!-- 日志显示区域 -->
                    <ScrollViewer x:Name="LogScrollViewer" VerticalScrollBarVisibility="Auto">
                        <TextBox x:Name="LogTextBox" TextWrapping="Wrap" 
                                 IsReadOnly="True" 
                                 VerticalScrollBarVisibility="Auto" 
                                 AcceptsReturn="True"
                                 FontFamily="Consolas"
                                 FontSize="11"
                                 Background="#F8F8F8"/>
                    </ScrollViewer>
                </DockPanel>
            </GroupBox>
        </Grid>
    </Grid>
</Window>