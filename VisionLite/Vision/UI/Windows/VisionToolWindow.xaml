<Window x:Class="VisionLite.Vision.UI.Windows.VisionToolWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:VisionLite.Vision.UI.Controls"
        mc:Ignorable="d"
        Title="VisionLite - 视觉算法工具" 
        Height="800" Width="1200" 
        MinHeight="600" MinWidth="800"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- 工具栏按钮样式 -->
        <Style x:Key="ToolBarButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="MinWidth" Value="60"/>
            <Setter Property="Height" Value="28"/>
        </Style>
        
        <!-- 算法树视图样式 -->
        <Style x:Key="AlgorithmTreeViewStyle" TargetType="TreeView">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="White"/>
        </Style>
        
        <!-- 算法项样式 -->
        <Style x:Key="AlgorithmItemStyle" TargetType="TreeViewItem">
            <Setter Property="Padding" Value="3"/>
            <EventSetter Event="MouseDoubleClick" Handler="AlgorithmItem_MouseDoubleClick"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- 工具栏 -->
            <RowDefinition Height="*"/>     <!-- 主内容 -->
            <RowDefinition Height="Auto"/>  <!-- 状态栏 -->
        </Grid.RowDefinitions>
        
        <!-- 工具栏 -->
        <ToolBar Grid.Row="0" Background="#FFF8F8F8" BorderBrush="#FFCCCCCC" BorderThickness="0,0,0,1">
            <Button x:Name="LoadImageButton" 
                    Content="加载图像" 
                    Style="{StaticResource ToolBarButtonStyle}"
                    Click="LoadImageButton_Click"/>
            <Separator/>
            <Button x:Name="ExecuteButton" 
                    Content="执行算法" 
                    Style="{StaticResource ToolBarButtonStyle}"
                    Click="ExecuteButton_Click"
                    IsEnabled="False"/>
            <Button x:Name="ClearButton" 
                    Content="清空结果" 
                    Style="{StaticResource ToolBarButtonStyle}"
                    Click="ClearButton_Click"/>
            <Separator/>
            <Button x:Name="SaveResultButton" 
                    Content="保存结果" 
                    Style="{StaticResource ToolBarButtonStyle}"
                    Click="SaveResultButton_Click"
                    IsEnabled="False"/>
            <Separator/>
            <TextBlock Text="当前算法:" VerticalAlignment="Center" Margin="10,0,5,0"/>
            <TextBlock x:Name="CurrentAlgorithmText" 
                       Text="未选择" 
                       VerticalAlignment="Center" 
                       FontWeight="Bold"
                       Foreground="DarkBlue"/>
        </ToolBar>
        
        <!-- 主内容区域 -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250" MinWidth="200"/>  <!-- 左侧算法列表 -->
                <ColumnDefinition Width="5"/>                   <!-- 分隔器 -->
                <ColumnDefinition Width="*" MinWidth="400"/>    <!-- 中央图像显示 -->
                <ColumnDefinition Width="5"/>                   <!-- 分隔器 -->
                <ColumnDefinition Width="320" MinWidth="250"/>  <!-- 右侧参数面板 -->
            </Grid.ColumnDefinitions>
            
            <!-- 左侧：算法列表 -->
            <GroupBox Grid.Column="0" Header="算法列表" Background="White">
                <TreeView x:Name="AlgorithmTreeView" 
                          Style="{StaticResource AlgorithmTreeViewStyle}">
                    
                    <TreeViewItem Header="图像预处理" IsExpanded="True">
                        <TreeViewItem Header="高斯滤波" 
                                      Tag="GaussianFilter"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                        <TreeViewItem Header="中值滤波" 
                                      Tag="MedianFilter"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                        <TreeViewItem Header="均值滤波" 
                                      Tag="MeanFilter"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                        <TreeViewItem Header="固定阈值二值化" 
                                      Tag="FixedThreshold"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                        <TreeViewItem Header="OTSU自动阈值二值化" 
                                      Tag="OTSUThreshold"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                        <TreeViewItem Header="基于局部方差的自适应阈值二值化" 
                                      Tag="VarThreshold"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                        <TreeViewItem Header="基于局部统计的自适应阈值二值化" 
                                      Tag="DynThreshold"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                        <TreeViewItem Header="形态学腐蚀" 
                                      Tag="MorphologyErosion"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                        <TreeViewItem Header="形态学膨胀" 
                                      Tag="MorphologyDilation"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                        <TreeViewItem Header="形态学开运算" 
                                      Tag="MorphologyOpening"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                        <TreeViewItem Header="形态学闭运算" 
                                      Tag="MorphologyClosing"
                                      Style="{StaticResource AlgorithmItemStyle}"/>
                    </TreeViewItem>
                    
                    <TreeViewItem Header="边缘检测">
                        <TreeViewItem Header="Canny边缘检测" 
                                      Tag="CannyEdge"
                                      Style="{StaticResource AlgorithmItemStyle}"
                                      IsEnabled="False"/>
                        <TreeViewItem Header="Sobel边缘检测" 
                                      Tag="SobelEdge"
                                      Style="{StaticResource AlgorithmItemStyle}"
                                      IsEnabled="False"/>
                    </TreeViewItem>
                    
                    <TreeViewItem Header="几何测量">
                        <TreeViewItem Header="圆拟合" 
                                      Tag="CircleFitting"
                                      Style="{StaticResource AlgorithmItemStyle}"
                                      IsEnabled="False"/>
                        <TreeViewItem Header="直线拟合" 
                                      Tag="LineFitting"
                                      Style="{StaticResource AlgorithmItemStyle}"
                                      IsEnabled="False"/>
                    </TreeViewItem>
                    
                </TreeView>
            </GroupBox>
            
            <!-- 左侧分隔器 -->
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Background="#FFDDDDDD"/>
            
            <!-- 中央：图像显示区域 -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- 图像选择标签 -->
                <TabControl x:Name="ImageTabControl" Grid.Row="1">
                    <TabItem Header="原始图像">
                        <controls:ImageDisplayControl x:Name="OriginalImageDisplay"
                                                      AutoFitToWindow="True"
                                                      ShowImageInfo="True"/>
                    </TabItem>
                    <TabItem Header="处理结果">
                        <controls:ImageDisplayControl x:Name="ResultImageDisplay"
                                                      AutoFitToWindow="True"
                                                      ShowImageInfo="True"/>
                    </TabItem>
                </TabControl>
            </Grid>
            
            <!-- 右侧分隔器 -->
            <GridSplitter Grid.Column="3" HorizontalAlignment="Stretch" Background="#FFDDDDDD"/>
            
            <!-- 右侧：参数和结果面板 -->
            <Grid Grid.Column="4">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="5"/>
                    <RowDefinition Height="250" MinHeight="150"/>
                </Grid.RowDefinitions>
                
                <!-- 参数配置面板 -->
                <controls:ParameterPanel x:Name="AlgorithmParameterPanel" Grid.Row="0"/>
                
                <!-- 垂直分隔器 -->
                <GridSplitter Grid.Row="1" HorizontalAlignment="Stretch" Background="#FFDDDDDD"/>
                
                <!-- 结果信息面板 -->
                <GroupBox Grid.Row="2" Header="处理结果">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="ResultInfoPanel" Margin="5">
                            <TextBlock x:Name="NoResultText" 
                                       Text="暂无处理结果" 
                                       HorizontalAlignment="Center" 
                                       VerticalAlignment="Center"
                                       FontStyle="Italic"
                                       Foreground="Gray"
                                       Margin="10"/>
                        </StackPanel>
                    </ScrollViewer>
                </GroupBox>
            </Grid>
        </Grid>
        
        <!-- 状态栏 -->
        <StatusBar Grid.Row="2" Background="#FFF0F0F0" BorderBrush="#FFCCCCCC" BorderThickness="0,1,0,0">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="就绪"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="ProcessingTimeText" Text=""/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="ImageInfoText" Text=""/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <ProgressBar x:Name="ProcessingProgressBar" 
                             Width="150" Height="16" 
                             Visibility="Collapsed"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>