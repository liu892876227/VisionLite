
● 📋 ModbusTCP服务器完整测试方案

  第一步：启动VisionLite ModbusTCP服务器

● Update Todos
  ⎿  [ ] 启动VisionLite ModbusTCP服务器
     [ ] 配置HslCommunication测试客户端
     [ ] 测试基本连接功能
     [ ] 测试地址映射读写功能
     [ ] 验证数据类型转换
     [ ] 测试并发连接

● 1. 启动VisionLite应用程序
  # 在Debug目录下启动
  E:\mySoftware\VisionLite\VisionLite\bin\Debug\VisionLite.exe
  2. 添加ModbusTCP服务器连接
    - 打开通讯配置窗口
    - 选择"添加连接"
    - 协议类型选择："ModbusTCP服务器"
    - 配置参数：
        - 连接名称：ModbusTCP_Test_Server
      - IP地址：127.0.0.1 （本地测试）
      - 端口：502 （标准ModbusTCP端口）
      - Unit ID：1 （从站ID）
      - 最大客户端数：5
      - 启用日志：☑️ 勾选
  3. 启动服务器
    - 点击"测试连接"验证配置
    - 启动ModbusTCP服务器

  第二步：配置HslCommunication测试客户端

● Update Todos
  ⎿  [×] 启动VisionLite ModbusTCP服务器
     [ ] 配置HslCommunication测试客户端
     [ ] 测试基本连接功能
     [ ] 测试地址映射读写功能
     [ ] 验证数据类型转换
     [ ] 测试并发连接

● 根据您的截图，在HslCommunication工具中：

  基本连接参数：
  - IP地址：192.168.0.100 → 改为 127.0.0.1
  - 端口号：502 （保持不变）
  - 站号：1 （保持不变）
  - 连接按钮：点击"连接"

  第三步：测试基本连接功能

● Update Todos
  ⎿  [×] 启动VisionLite ModbusTCP服务器
     [×] 配置HslCommunication测试客户端
     [ ] 测试基本连接功能
     [ ] 测试地址映射读写功能
     [ ] 验证数据类型转换
     [ ] 测试并发连接

● 预期结果：
  - ✅ 连接状态显示为"已连接"
  - ✅ 能够成功建立TCP连接
  - ✅ VisionLite控制台输出连接日志

  如果连接失败，检查：
  - 防火墙是否阻止502端口
  - VisionLite服务器是否正常启动
  - IP地址和端口是否正确

  第四步：测试地址映射读写功能

● Update Todos
  ⎿  [×] 启动VisionLite ModbusTCP服务器
     [×] 配置HslCommunication测试客户端
     [×] 测试基本连接功能
     [ ] 测试地址映射读写功能
     [ ] 验证数据类型转换
     [ ] 测试并发连接

● 根据我们创建的默认地址映射，测试以下地址：

  4.1 测试线圈区域（Coil - 0x区域）

  地址: 00001 (系统启动状态)    - 默认: false
  地址: 00002 (相机连接状态)    - 默认: false
  地址: 00010 (检测完成信号)    - 默认: false

  操作步骤：
  1. 在"单个线圈读取测试"区域
  2. 地址输入：1
  3. 点击"bool读取"
  4. 预期结果：显示 False

  4.2 测试离散输入区域（Discrete Input - 1x区域）

  地址: 10001 (触发拍照)       - 默认: false
  地址: 10002 (系统复位)       - 默认: false

  操作步骤：
  1. 在"单个线圈读取测试"区域（注意：有些工具用同一个界面）
  2. 地址输入：10001
  3. 点击"bool读取"
  4. 预期结果：显示 False

  4.3 测试输入寄存器区域（Input Register - 3x区域）

  地址: 30200 (检测结果X坐标)   - 默认: 0
  地址: 30201 (检测结果Y坐标)   - 默认: 0
  地址: 30300 (检测合格率-Float) - 默认: 0.0 (占用2个寄存器)

  操作步骤：
  1. 在"批量读取测试"区域
  2. 地址输入：200（注意：通常要减去30000的偏移）
  3. 长度输入：2
  4. 点击"批量读取"
  5. 预期结果：显示 0, 0

  4.4 测试保持寄存器区域（Holding Register - 4x区域）

  地址: 40100 (曝光时间)       - 默认: 1000
  地址: 40101 (增益值)         - 默认: 100

  操作步骤：
  1. 在"批量读取测试"区域
  2. 地址输入：100（注意：通常要减去40000的偏移）
  3. 长度输入：2
  4. 点击"批量读取"
  5. 预期结果：显示 1000, 100

  第五步：验证数据类型转换

● Update Todos
  ⎿  [×] 启动VisionLite ModbusTCP服务器
     [×] 配置HslCommunication测试客户端
     [×] 测试基本连接功能
     [×] 测试地址映射读写功能
     [ ] 验证数据类型转换
     [ ] 测试并发连接

● 5.1 测试Float类型读取

  地址: 40300 (检测合格率 - Float)
  默认值: 0.0 (占用地址300和301两个寄存器)

  操作步骤：
  1. 在"批量读取测试"区域
  2. 地址输入：300
  3. 长度输入：2
  4. 点击"批量读取"
  5. 使用"float读取"按钮读取浮点数
  6. 预期结果：显示 0.0

  5.2 测试写入操作

  写入Bool值：
  1. 地址：1 (系统启动状态)
  2. 值：True
  3. 点击"bool写入"
  4. 再次读取验证

  写入UInt16值：
  1. 地址：100 (曝光时间)
  2. 值：2000
  3. 点击"ushort写入"
  4. 再次读取验证

  第六步：测试并发连接

● Update Todos
  ⎿  [×] 启动VisionLite ModbusTCP服务器
     [×] 配置HslCommunication测试客户端
     [×] 测试基本连接功能
     [×] 测试地址映射读写功能
     [×] 验证数据类型转换
     [ ] 测试并发连接

● 1. 打开多个HslCommunication实例
  2. 同时连接到同一个服务器
  3. 同时执行读写操作
  4. 验证服务器最大客户端数限制（配置为5个）

  📊 测试检查清单

  | 测试项目    | 地址          | 预期结果       | 实际结果 | 状态  |
  |---------|-------------|------------|------|-----|
  | 线圈读取    | 00001       | false      | ___  | ⏳   |
  | 线圈写入    | 00001       | true→false | ___  | ⏳   |
  | 离散输入    | 10001       | false      | ___  | ⏳   |
  | 输入寄存器   | 30200-30201 | [0,0]      | ___  | ⏳   |
  | 保持寄存器   | 40100-40101 | [1000,100] | ___  | ⏳   |
  | Float读取 | 40300-40301 | 0.0        | ___  | ⏳   |
  | 并发连接    | 多客户端        | 支持5个连接     | ___  | ⏳   |

  🔧 故障排除

  如果测试过程中遇到问题：

  1. 连接失败
    - 检查VisionLite服务器状态
    - 确认IP地址和端口配置
    - 检查防火墙设置
  2. 读取数据异常
    - 检查地址映射配置文件
    - 验证地址偏移量计算
    - 查看VisionLite控制台日志
  3. 数据类型错误
    - 确认数据类型映射正确
    - 验证字节序转换
    - 检查浮点数占用的寄存器数量


 1. 启动VisionLite ModbusTCP服务器

  - 在VisionLite中创建ModbusTCP服务器连接
  - 确保服务器运行在 127.0.0.1:502

  2. HslCommunication工具连接设置

  - IP地址：127.0.0.1
  - 端口：502
  - 站号：1
  - 点击"断开连接"，然后"重新连接"

  字节序格式测试步骤

  第一步：写入测试数据

  在HslCommunication的单数据读写测试区域：
  1. 地址: 输入 30300 (对应我们文档中的检测合格率地址)
  2. 值: 输入 100.5
  3. 点击 "float写入" 按钮

  第二步：读取原始寄存器值验证

  切换到批量数据读取测试区域：
  1. 地址: 输入 300 (对应30300-30301两个寄存器)
  2. 长度: 输入 2
  3. 点击 "批量读取" 按钮
  4. 查看结果中显示的两个16位寄存器的原始值

  第三步：对照期望值判断字节序

  根据读取的寄存器原始值判断当前字节序格式：

  100.5的IEEE754表示为：0x42C90000

  - 如果显示 [42C9, 0000] → VisionLite使用ABCD格式 ✓
  - 如果显示 [C942, 0000] → VisionLite使用BADC格式 ✓
  - 如果显示 [0000, 42C9] → VisionLite使用CDAB格式 ✓
  - 如果显示 [0000, C942] → VisionLite使用DCBA格式 ✓

  第四步：切换HslCommunication的数据格式

  在图中的数据格式下拉菜单中：
  1. 选择对应的格式（ABCD/BADC/CDAB/DCBA）
  2. 重新进行float读取测试

  第五步：验证读取结果

  在单数据读写测试区域：
  1. 地址: 30300
  2. 点击 "float读取" 按钮
  3. 期望结果: 应该正确显示 100.5

  完整测试矩阵

  建议测试多个数值来确保准确性：

  | 测试值     | IEEE754十六进制 | ABCD格式寄存器    | BADC格式寄存器    | CDAB格式寄存器    | DCBA格式寄存器    |
  |---------|-------------|--------------|--------------|--------------|--------------|
  | 100.5   | 0x42C90000  | [42C9, 0000] | [C942, 0000] | [0000, 42C9] | [0000, C942] |
  | 95.5    | 0x42BF8000  | [42BF, 8000] | [BF42, 0080] | [8000, 42BF] | [0080, BF42] |
  | 123.456 | 0x42F6E979  | [42F6, E979] | [F642, 79E9] | [E979, 42F6] | [79E9, F642] |
